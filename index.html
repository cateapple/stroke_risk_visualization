<html>
    <head>
        <meta charset="UTF-8">
        <title>Stroke risk factor visualizations</title>
        <link rel="stylesheet" type="text/css" href="style.css">
        <script src="https:d3js.org/d3.v6.min.js"></script>
    </head>
    <body>
        <h3>Catherine Appleby (caa96), Esuvat Bomani (ekb72), Mia Bravo (mvb43)</h3>
        <p>
            <svg id="lifefactors" height="800" width="1000">

            </svg>

            <script>

            const svg = d3.select("svg#lifefactors");

            const width = svg.attr("width");
            const height = svg.attr("height");
            const margins = {"top": 50, "right": 20, "bottom": 20, "left": 150};

            const chartWidth = width - margins.left - margins.right;
            const chartHeight = height - margins.top - margins.bottom;

            let annotated = svg.append("g").attr("id","price");

            let chartArea = svg.append("g").attr("id","points")
                            .attr("transform","translate("+margins.left+","+margins.top+")");

            var lifedata;
            d3.json("life_factors_new.json", d3.autoType).then((data) => {
                lifedata = data;

                //Make bar scales
                // x is stroke or not - 0 or 1
                // const xaxisExtent = d3.extent(lifedata, d => d["stroke"]);
                const xScale = d3.scaleLinear().domain([0, 5]).range([0, chartWidth]);

                //y scale is the number of bars we're making evenly distributed over the area of the chart
                const yScale = d3.scaleBand().domain(lifedata.map(function(d) {console.log(d.Category);   return d.Category;})).range([chartHeight, 0]).padding([0.05]);


                //conditional color scales - 3 main categories -
                // const colScale = d3.interpolate(colorGiver(category))

                function colorGiver(category){
                    // if it is a residence type, set color based on type. index first letter and last letter to decide
                    if(String(category).charAt(0) == "R"){
                        if(String(category).charAt(String(category).length-1) == "n"){
                            return d3.interpolatePurples(0.75)
                        }
                        else{
                            return d3.interpolatePurples(1)
                        }

                    }
                    // if it is ever married, set the kinds and their colors. index first letter and last letter to decide
                    if (String(category).charAt(0) == "e"){
                        if(String(category).charAt(String(category).length-1) == "o"){
                            return d3.interpolateReds(0.75)
                        }
                        else{
                            return d3.interpolateReds(1)
                        }

                    }
                    //if it is a work type, there are 5 different kinds so set the blue based on which one it is. Indexing on first and last letter to figure out which type
                    if (String(category).charAt(0) == "w"){

                        if(String(category).charAt(String(category).length-1) == "e"){
                            return d3.interpolateBlues(1)
                        }

                        if(String(category).charAt(String(category).length-1) == "d"){
                            return d3.interpolateBlues(0.8)
                        }

                        if(String(category).charAt(String(category).length-1) == "b"){
                            return d3.interpolateBlues(0.6)
                        }

                        if(String(category).charAt(String(category).length-1) == "n"){
                            return d3.interpolateBlues(0.4)
                        }
                        else{
                            return d3.interpolateBlues(0.2)
                        }
                    }

                }

                //axes append
                let leftAxis = d3.axisLeft(yScale).tickFormat( tick => tick.charAt(0).toUpperCase() + tick.slice(1).replace(/_/g, " "));
                annotated.append("g").attr("class", "y axis")
                                        .attr("transform", "translate("+(margins.left)+","+(margins.top)+")")
                                        .call(leftAxis);

                let bottomAxis = d3.axisBottom(xScale);
                let bottomGridLines = d3.axisBottom(xScale).tickFormat("").tickSize(-chartHeight);
                annotated.append("g").attr("class", "x axis")
                                        .attr("transform", "translate("+(margins.left)+","+(margins.top + chartHeight)+")")
                                        .call(bottomAxis);
                annotated.append("g").attr("class", "x gridlines")
                                        .attr("transform", "translate("+(margins.left)+","+(margins.top + chartHeight)+")")
                                        .call(bottomGridLines);

                //append to chart
                chartArea.selectAll("rect").data(lifedata)
                    .join("rect")
                    .attr("x", xScale(0))
                    .attr("y", function(d) { return yScale(d.Category); })
                    .attr("width", function(d) { return xScale(d.Percentage); })
                    .attr("height", yScale.bandwidth() )
                    .attr("fill", function(d) {return colorGiver(d.Category);})
            });

            </script>
        </p>

        <p>
          <svg id="healthfactors" height="900" width="1000"></svg>
          <script>
              //graph area for health factors graph
              const svghealth = d3.select("svg#healthfactors");

              const widthH = svghealth.attr("width");
              const heightH = svghealth.attr("height");
              const marginsH = {"top": 50, "right": 20, "bottom": 100, "left": 150};

              const chartWidthH = widthH - marginsH.left - marginsH.right;
              const chartHeightH = heightH - marginsH.top - marginsH.bottom;

              let annotations = svghealth.append("g");
              let chart = svghealth.append("g").attr("transform","translate("+marginsH.left+","+marginsH.top+")");

              d3.json("health_factors.json", d3.autoType).then((data) => {
                console.log(Object.values(data));

                let groups = Array.from(new Set(Object.values(data).map(d => d.risk_factor)));
                let subgroups = Array.from(new Set(Object.values(data).map(d => d.gender))).slice(0,2);

                let xScaleH = d3.scaleLinear().domain([0,127]).range([0, chartWidthH]);
                let yScaleH = d3.scaleBand().domain(groups).range([chartHeightH, 0]).padding([0.05]);
                let ySubgroup = d3.scaleBand()
                                  .domain(subgroups)
                                  .range([0, yScaleH.bandwidth()])
                                  .padding([0.03]);

                let bottomAxisH = d3.axisBottom(xScaleH);
                let bottomGridLinesH = d3.axisBottom(xScaleH).tickFormat("").tickSize(-chartHeight);
                annotations.append("g").attr("class", "x axis")
                                       .attr("transform", "translate("+(marginsH.left)+","+(marginsH.top + chartHeightH)+")")
                                       .raise()
                                       .call(bottomAxisH);
                annotations.append("g").attr("class", "gridlines")
                                       .attr("transform", "translate("+(marginsH.left)+","+(marginsH.top + chartHeightH)+")")
                                       .call(bottomGridLinesH);

                let leftAxisH = d3.axisLeft(yScaleH).tickFormat( tick => tick.charAt(0).toUpperCase() + tick.slice(1).replace(/_/g, " "));
                annotations.append("g").attr("class", "y axis")
                                       .attr("transform", "translate("+(marginsH.left)+","+(marginsH.top) +")")
                                       .raise()
                                       .call(leftAxisH);

                const groupEnter = chart.selectAll("g").data(groups)
                     .enter()
                     .append("g")
                     .attr("transform", d => `translate(0, ${yScaleH(d)})`)
                     .selectAll("rect")
                     .data(d => Object.values(data).filter(e => e.risk_factor === d))
                     .enter()

                groupEnter.append("rect")
                     .lower()
                     .attr("x", xScaleH(0))
                     .attr("y", d => ySubgroup(d.gender))
                     .attr("width", d => xScaleH(d.strokes))
                     .attr("height", d => ySubgroup.bandwidth())
                     .attr("fill", d => {
                                   if(d.gender === "Male"){
                                     return d3.interpolateBlues(0.8);
                                   }
                                   if(d.gender === "Female"){
                                     return d3.interpolateReds(0.75);
                                   }
                                 }
                           )

                groupEnter.append("text")
                          .text(d => d.strokes)
                          .attr("x", 10)
                          .attr("y", d => ySubgroup(d.gender) + ySubgroup.bandwidth()/2 + 7)
                          .attr("fill", "white")


                svghealth.append("text")
                         .text("Health Factors")
                         .attr("transform", `rotate(270,50,${heightH/2})`)
                         .attr("text-anchor", "middle")
                         .attr("x", 50)
                         .attr("y", heightH/2)

                svghealth.append("text")
                        .text("Number of Strokes")
                        .attr("x", widthH/2)
                        .attr("y", 850)

                svghealth.append("circle").attr("cx",900).attr("cy",850).attr("r", 8).style("fill", d3.interpolateBlues(0.8))
                svghealth.append("circle").attr("cx",900).attr("cy",880).attr("r", 8).style("fill", d3.interpolateReds(0.75))
                svghealth.append("text").attr("x", 920).attr("y", 850).text("Male").style("font-size", "15px").attr("alignment-baseline","middle")
                svghealth.append("text").attr("x", 920).attr("y", 880).text("Female").style("font-size", "15px").attr("alignment-baseline","middle")


              });
        </script>
      </p>
    </body>
</html>
